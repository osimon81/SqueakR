---
title: "SqueakR"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{SqueakR}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# Introduction

The SqueakR package is a centralized, experiment-centered approach to organizing and analyzing data exported from [`DeepSqueak`](https://github.com/DrCoffey/DeepSqueak). Of its diverse functions, SqueakR is capable of generating quick plots from vocalization data detected from `DeepSqueak`. On top of these visualizations, the package contains functions which combine all exported DeepSqueak data from multiple recordings into a single experimental object, allowing subsequent analysis to be conducted directly from R.

# Installation

## From GitHub

To use SqueakR, we need to install the package. To do so, run the code below. Ensure the `devtools` package is installed before running the following:

```{r install, eval=FALSE}
library(devtools)
install_github("osimon81/SqueakR")
```

Next, load the package:

```{r setup}
library(SqueakR)
```

# The Experimental Object

## Creating an Experiment

This package allows all data necessary for visualizations to be stored in a single object. However, to do so, the experimental object must be created. To create an `experiment`, run the following code:

```{r create experiment}
experiment <- create_experiment(experiment_name = "my_experiment")
```

This code creates a new `experiment` object, with the name `my_experiment`. When the object is saved, it will be saved using this name, along with a timestamp. At this point, there's nothing stored in this `experiment` object except its name, but let's inspect how `experiment` is structured:

```{r experiment structure}
str(experiment)
```

We can see from the `str()` function that the `experiment` object has 5 main groups listed in it:

-   `name`: The name we just set for this experiment
-   `last_saved`: A timestamp for the last time this experiment was saved (in this case, this is the time the object was created)
-   `groups`: An empty variable which will be configured to show the experimental groups
-   `experimenters`: An empty variable which will be configured to show the experimenters who collected data
-   `experimental_data`: An empty list which will store all of the data for this experiment

Now that our experiment is created, we can start to add data to it.

## Loading Data

When call data is exported from DeepSqueak, it includes all detected calls through the length of the recording. However, sometimes, we're only interested in calls within a certain range of the entire recording. SqueakR has the `add_timepoint_data()` function to assist with this:

```{r add timepoint data}
my_new_data <- add_timepoint_data(data_path = "../inst/extdata/Example_Mouse_Data.xlsx", t1 = 5, t2 = 25)
```

The parameters for `add_timepoint_data()` are defined as follows:

-   `data_path`: The full path to the data file

-   `t1`: The timepoint at which calls will start being extracted into the `my_new_data` object

-   `t2`: The timepoint at which calls will stop being extracted into the object.

In the context of the code above, we've just extracted all of the calls in the 5-25 second region. To view the data we've extracted to confirm this:

```{r view head and tail of extracted data}
# The first few rows of the dataset
head(my_new_data)

# The last few rows of the dataset
tail(my_new_data)
```

If we inspect the `Begin Time (s)` column in the first table that generated above, you'll notice the first observation (row) represents a call that begins at \~5 seconds. Inspecting the `End Time (s)` column in the second table, the last call in the dataset ends at \~24 seconds, indicating that we've selected the 5-25 region for calls.

## Scoring Data

Once raw data is loaded into R, we can calculate some summary statistics on the region we've selected. To do this, run the following code:

```{r scored data}
my_scored_data <- score_timepoint_data(data_subset = my_new_data,
                                    group = "Control",
                                    experimenter = "my_name")
str(my_scored_data)
```

### Data Structure

Since there is a lot of data contained in this object, here is a summary of the structure.

The following variables are assigned to a single value:

-   `group`: The experimental group specified in the score_timepoint_data() function.
-   `experimenter`: The experimenter who collected the data
-   `calls_n`: The number of detected calls in the following range

The rest of these variables are extracted from the `my_new_data` object have sub-variables stored under them: mean, standard_deviation, and range:
-   `call_length`
-   `delta_frequency`
-   `high_frequency`
-   `low_frequency`
-   `peak_frequency`
-   `power_mean`
-   `principal_frequency`
-   `sinuosity`
-   `slope`
-   `tonality`

More information about the above variables can be found on the [DeepSqueak wiki](https://github.com/DrCoffey/DeepSqueak/wiki/export-to-excel). Finally, the raw variable contains the entire extracted dataset (the `my_new_data` object), which can be referenced when plotting the raw data.

The data may appear complicated, but this will be useful later on to organize the data!

## Adding Scored Data to Experiment

Now our data is prepared, we can add it to the experiment object we created. To do so, we can use the `add_to_experiment()` function. The parameters for the function are the experiment object (which we've conveniently labeled experiment), and the data we want to add (which we just assigned to `my_scored_data` in the previous section).

```{r adding data to experiment and update experiment}
experiment <- add_to_experiment(experiment = experiment, added_data = my_scored_data)
```

## Summarizing the Experiment

Now, our new data is added to our experiment object! As seen in the previous section, running `str(experiment)` can produce an unwieldy representation of our experiment, so this is discouraged when dealing with large experiments. As an alternative, we can run the following SqueakR function:

```{r describe experiment}
describe_experiment(experiment = experiment)
```

This can be a great way to inspect the contents of our experiment, and it condenses some of the parameters we set earlier.

### Updating the Experiment

The `add_to_experiment()` function runs another SqueakR function inside of it: `update_experiment()`. This function updates the "Experimenters" and "Experimental groups" fields within our `experiment` object to reflect the data which is stored in it. In other words, when we add data that specifies a different experimental group or a different experimenter, the Experimenters and Experimental groups will auto-populate.

For complete documentation, the function is run below (however, since the experiment was already updated through the `add_to_experiment()` function, it will not change any values). It looks through the data stored in the experiment object, and searches for new groups or new experimenters. These new groups or experimenters are added to the `groups` and `experimenters` variables stored in the experiment object.

```{r update experiment function}
experiment <- update_experiment(experiment)
```
















